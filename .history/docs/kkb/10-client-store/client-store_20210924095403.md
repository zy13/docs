## 1、概要
### 主要内容
- 在`koa`中`cookie`的使用方式
- 客户端`cookie`的使用方式
- `localStorage`及`sessionStorage`使用
- 各种本地存储的异同

### 目标

- 学会`cookie`在服务端及客户端的使用方式
- 会使用`localStorage`及`sessionStorage`做数据的持久化
- 了解各种本地存储的异同

### 客户端储存方案

- **服务端储存**
  - 服务端文件储存
  - 内存
  - 数据库：`mysql`、`mongoodb`、`Oracle`等等。

- **客户端储存(离线储存)**
  - 浏览器

## 2、服务端 cookie
`cookie`是`http`协议下，服务端或者脚本可以维护客户端信息的一种方式。
- 123
### koa 中 cookie 的使用

```js
// 储存 cookie 的值
ctx.cookies.set(name, value, [options])

// 获取cookie的值
ctx.cookies.get(name, [options])
```
**options 常用设置**
- `maxAge` 一个数字表示从 `Date.now()` 得到的毫秒数
- `expires` cookie 过期的 `Date`
- `path` cookie 路径, 默认是`'/'`
- `domain` cookie 域名
- `secure` 安全 cookie  设置后只能通过 https 来传递 cookie
- `httpOnly` 服务器可访问 cookie, 默认是 **true**
- `overwrite` 一个布尔值，表示是否覆盖以前设置的同名的 cookie. 
  - 默认是 `false`
  - 如果是 `true`, 在同一个请求中设置相同名称的所有 cookie
  
## 3、cookie应用 - 登录案例
- 验证用户名密码是否正确；
- 实现登录功能，通过记住我实现七天免登录；
```js
// app.js

// 登录路由
router.get('/login', async ctx => {
  const isLogin = ctx.cookies.get('isLogin')
  if (isLogin) {
    const serverData = md5('abc'+'123')
    if (isLogin === serverData) {
      await ctx.redirect('/list')
    }
  }
  await ctx.render('login.pug')
})

// 验证用户账号密码
router.post('/checkUser',async ctx => {
  const {username,pwd, memberMe} = ctx.request.body
  if (username === 'abc' && pwd === '123') {
    // 记住我
    if (memberMe) {
      const isLogin = md5('abc' + '123') 
      ctx.cookies.set('isLogin',isLogin, {
        maxAge: 3600*1000*24*7 // 七天，服务端时间单位为ms
      })
    }
    ctx.redirect('/list')
  } else {
    ctx.redirect('/error')
  }
})
```

## 4、客户端的 cookie

### 设置 cookie
```js
document.cookie = "key=value"
```
`key` 和 `value` 是包含在一个字符串中
- **key 包含字段**
  - `[name]` 这个 name 为自己取的 cookie 名称，同名的值会覆盖
  - `domain` 所属域名
  - `path` 所属路径
  - `Expires/Max-Age` 到期时间/持续时间 (单位是秒)
  - `http-only` 是否只作为 http 时使用，如果为 `true`，那么客户端能够在 http 请求和响应中进行传输，但是客户端浏览器不能使用 js 去读取或修改
- 多个 key=value 使用`;`（分号）分隔

### 获取cookie

返回值是当前域名下的所有 cookie，并按照某种格式组织的字符串 ：`key=value; key1=value1; ......keyn=valuen`
```js
document.cookie // 每个cookie 之间用分号+一个空格隔开
```

### 封装存取 cookie 的 api
```js
// 设置cookie
function setCookie(name, value, options) {
  let cookieData = `${name}=${value};`
  for(let key in options) {
    let str = `${key}=${options[key]};`
    cookieData += str
  }
  document.cookie = cookieData
}

// 获取cookie
function getCookie(name) {
  let arr = document.cookie.split('; ')
  for(let i=0; i<arr.length;i++) {
    let items = arr[i].split('=')
    if (name === items[0]) {
      return items[1]
    }
  }
  return ''
}
```