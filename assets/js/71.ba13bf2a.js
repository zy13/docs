(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{372:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p",[a("a",{attrs:{href:"https://www.wangdoc.com/javascript/bom/same-origin.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("同源限制"),a("OutboundLink")],1)]),a("p",[t._v("浏览器安全的基石是“同源政策”（same-origin policy）。很多开发者都知道这一点，但了解得不全面。")]),t._m(0),a("ul",[a("li",[t._v("含义："),a("router-link",{attrs:{to:"./6-corsl.html#_1-1-含义"}},[t._v("link")])],1),a("li",[t._v("目的："),a("router-link",{attrs:{to:"./6-corsl.html#_1-2-目的"}},[t._v("link")])],1),a("li",[t._v("限制范围："),a("router-link",{attrs:{to:"./6-corsl.html#_1-3-限制范围"}},[t._v("link")])],1)]),t._m(1),t._m(2),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),a("p",[t._v("设想这样一种情况：")]),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),a("p",[t._v("虽然这些限制是必要的，但是有时很不方便，合理的用途也受到影响。下面介绍如何规避上面的限制。")]),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),a("ul",[a("li",[t._v("片段识别符："),a("router-link",{attrs:{to:"./6-corsl.html#_3-1-片段识别符"}},[t._v("link")])],1),a("li",[t._v("window.postMessage()："),a("router-link",{attrs:{to:"./6-corsl.html#_3-2-window-postmessage"}},[t._v("link")])],1),a("li",[t._v("LocalStorage："),a("router-link",{attrs:{to:"./6-corsl.html#_3-2-window-postmessage"}},[t._v("link")])],1)]),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),a("p",[t._v("对于完全不同源的网站，目前有两种方法，可以解决跨域窗口的通信问题。")]),t._m(37),t._m(38),t._m(39),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),t._m(45),t._m(46),t._m(47),t._m(48),t._m(49),t._m(50),t._m(51),t._m(52),t._m(53),t._m(54),t._m(55),t._m(56),t._m(57),t._m(58),a("p",[t._v("上面代码有几个地方需要注意。")]),t._m(59),a("p",[t._v("通常来说，这两种做法是不推荐的，因为不够安全，可能会被恶意利用。")]),t._m(60),t._m(61),t._m(62),t._m(63),t._m(64),t._m(65),t._m(66),t._m(67),a("ul",[a("li",[t._v("JSONP："),a("router-link",{attrs:{to:"./6-corsl.html#_4-1-jsonp"}},[t._v("link")])],1),a("li",[t._v("WebSocket："),a("router-link",{attrs:{to:"./6-corsl.html#_4-2-websocket"}},[t._v("link")])],1),a("li",[t._v("CORS："),a("router-link",{attrs:{to:"./6-corsl.html#_4-3-cors"}},[t._v("link")])],1)]),t._m(68),t._m(69),t._m(70),t._m(71),t._m(72),t._m(73),t._m(74),t._m(75),t._m(76),t._m(77),t._m(78),t._m(79),t._m(80),t._m(81),t._m(82),t._m(83),t._m(84),t._m(85),t._m(86),t._m(87),t._m(88)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1、概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、概述","aria-hidden":"true"}},[this._v("#")]),this._v(" 1、概述")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-1-含义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-含义","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1 含义")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("1995")]),this._v("年，同源政策由 "),s("code",[this._v("Netscape")]),this._v(" 公司引入浏览器。目前，所有浏览器都实行这个政策。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最初，它的含义是指，"),s("code",[this._v("A")]),this._v(" 网页设置的 "),s("code",[this._v("Cookie")]),this._v("，"),s("code",[this._v("B")]),this._v(" 网页不能打开，除非这两个网页“同源”。所谓“同源”指的是“三个相同”。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("协议相同")]),s("li",[this._v("域名相同")]),s("li",[this._v("端口相同（浏览器会忽略这点）")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("例如，"),a("code",[t._v("http://www.example.com/dir/page.html")]),t._v("这个网址，协议是"),a("code",[t._v("http://")]),t._v("，域名是"),a("code",[t._v("www.example.com")]),t._v("，端口是"),a("code",[t._v("80")]),t._v("（默认端口可以省略），它的同源情况如下。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("http://www.example.com/dir2/other.html")]),t._v("：同源")]),a("li",[a("code",[t._v("http://example.com/dir/other.html")]),t._v("：不同源（域名不同）")]),a("li",[a("code",[t._v("http://v2.www.example.com/dir/other.html")]),t._v("：不同源（域名不同）")]),a("li",[a("code",[t._v("http://www.example.com:81/dir/other.html")]),t._v("：不同源（端口不同）")]),a("li",[a("code",[t._v("https://www.example.com/dir/page.html")]),t._v("：不同源（协议不同）")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("strong",[t._v("注意，标准规定端口不同的网址不是同源（比如"),a("code",[t._v("8000")]),t._v("端口和"),a("code",[t._v("8001")]),t._v("端口不是同源），但是浏览器没有遵守这条规定。实际上，同一个网域的不同端口，是可以互相读取 "),a("code",[t._v("Cookie")]),t._v(" 的")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-2-目的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-目的","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.2 目的")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("同源政策的目的，是"),s("strong",[this._v("为了保证用户信息的安全，防止恶意的网站窃取数据")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("A")]),t._v(" 网站是一家银行，用户登录以后，"),a("code",[t._v("A")]),t._v(" 网站在用户的机器上设置了一个 "),a("code",[t._v("Cookie")]),t._v("，包含了一些隐私信息。")]),a("li",[t._v("用户离开 "),a("code",[t._v("A")]),t._v(" 网站以后，又去访问 "),a("code",[t._v("B")]),t._v(" 网站，如果没有同源限制，"),a("code",[t._v("B")]),t._v(" 网站可以读取 "),a("code",[t._v("A")]),t._v(" 网站的 "),a("code",[t._v("Cookie")]),t._v("，那么隐私就泄漏了。")]),a("li",[t._v("更可怕的是，"),a("code",[t._v("Cookie")]),t._v(" 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。"),a("br"),t._v("\n因为浏览器同时还规定，"),a("strong",[t._v("提交表单不受同源政策的限制")]),t._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由此可见，同源政策是必需的，否则 "),s("code",[this._v("Cookie")]),this._v(" 可以共享，互联网就毫无安全可言了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-3-限制范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-限制范围","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.3 限制范围")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("随着互联网的发展，同源政策越来越严格。目前，如果非同源，共有"),s("strong",[this._v("三种行为受到限制")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("（1） 无法读取非同源网页的 "),a("code",[t._v("Cookie")]),t._v("、"),a("code",[t._v("LocalStorage")]),t._v(" 和 "),a("code",[t._v("IndexedDB")]),t._v("。")]),a("li",[t._v("（2） 无法接触非同源网页的 "),a("code",[t._v("DOM")]),t._v("。")]),a("li",[t._v("（3） 无法向非同源地址发送 "),a("code",[t._v("AJAX")]),t._v(" 请求（可以发送，但浏览器会拒绝接受响应）。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("另外，通过 "),a("code",[t._v("JavaScript")]),t._v(" 脚本可以拿到其他窗口的"),a("code",[t._v("window")]),t._v("对象。如果是非同源的网页，目前允许一个窗口可以接触其他网页的"),a("code",[t._v("window")]),t._v("对象的"),a("strong",[t._v("九个属性")]),t._v("和"),a("strong",[t._v("四个方法")]),t._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("window.closed")]),a("li",[t._v("window.frames")]),a("li",[t._v("window.length")]),a("li",[t._v("window.location - 可读写")]),a("li",[t._v("window.opener")]),a("li",[t._v("window.parent")]),a("li",[t._v("window.self")]),a("li",[t._v("window.top")]),a("li",[t._v("window.window")]),a("li",[t._v("window.blur()")]),a("li",[t._v("window.close()")]),a("li",[t._v("window.focus()")]),a("li",[t._v("window.postMessage()")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("上面的"),a("strong",[t._v("九个属性")]),t._v("之中，只有"),a("code",[t._v("window.location")]),t._v("是可读写的，其他八个全部都是只读。而且，即使是"),a("code",[t._v("location")]),t._v("对象，非同源的情况下，也只允许调用"),a("code",[t._v("location.replace()")]),t._v("方法和写入"),a("code",[t._v("location.href")]),t._v("属性。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2、cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、cookie","aria-hidden":"true"}},[this._v("#")]),this._v(" 2、Cookie")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Cookie")]),this._v(" 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。如果两个网页一级域名相同，只是次级域名不同，浏览器允许通过设置"),s("code",[this._v("document.domain")]),this._v("共享 "),s("code",[this._v("Cookie")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"document-domain解决跨域问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#document-domain解决跨域问题","aria-hidden":"true"}},[this._v("#")]),this._v(" document.domain解决跨域问题")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("例如，"),a("code",[t._v("A")]),t._v(" 网页的网址是"),a("code",[t._v("http://w1.example.com/a.html")]),t._v("，"),a("code",[t._v("B")]),t._v(" 网页的网址是"),a("code",[t._v("http://w2.example.com/b.html")]),t._v("，那么只要设置相同的"),a("code",[t._v("document.domain")]),t._v("，两个网页就可以共享 "),a("code",[t._v("Cookie")]),t._v("。因为浏览器通过"),a("code",[t._v("document.domain")]),t._v("属性来检查是否同源。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 两个网页都需要设置")]),t._v("\ndocument"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'example.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("strong",[t._v("注意")]),t._v("，"),a("code",[t._v("A")]),t._v(" 和 "),a("code",[t._v("B")]),t._v(" 两个网页都需要设置"),a("code",[t._v("document.domain")]),t._v("属性，才能达到同源的目的。因为设置"),a("code",[t._v("document.domain")]),t._v("的同时，会把端口重置为"),a("code",[t._v("null")]),t._v("，因此如果只设置一个网页的"),a("code",[t._v("document.domain")]),t._v("，会导致两个网址的端口不同，还是达不到同源的目的。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// A 网页通过脚本设置一个 Cookie")]),t._v("\ndocument"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"test1=hello"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// B 网页就可以读到这个 Cookie")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" allCookie "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("注意，这种方法只适用于 Cookie 和 iframe 窗口，LocalStorage 和 IndexedDB 无法通过这种方法，规避同源政策，而要使用下文介绍 PostMessage API。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"服务器解决跨域问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器解决跨域问题","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务器解决跨域问题")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("另外，服务器也可以在设置 "),s("code",[this._v("Cookie")]),this._v(" 的时候，指定 "),s("code",[this._v("Cookie")]),this._v(" 的所属域名为一级域名，比如"),s("code",[this._v(".example.com")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 二级域名和三级域名不用做任何设置，都可以读取这个 Cookie。")]),t._v("\nSet"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Cookie"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("value"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" domain"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" path"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3、iframe-和多窗口通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、iframe-和多窗口通信","aria-hidden":"true"}},[this._v("#")]),this._v(" 3、iframe 和多窗口通信")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("iframe")]),t._v("元素可以在当前网页之中，嵌入其他网页。每个"),a("code",[t._v("iframe")]),t._v("元素形成自己的窗口，即有自己的"),a("code",[t._v("window")]),t._v("对象。"),a("code",[t._v("iframe")]),t._v("窗口之中的脚本，可以获得父窗口和子窗口。但是，只有在同源的情况下，父窗口和子窗口才能通信；如果跨域，就无法拿到对方的 "),a("code",[t._v("DOM")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("比如，父窗口运行下面的命令，如果"),s("code",[this._v("iframe")]),this._v("窗口不是同源，就会报错。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口想获取子窗口的 DOM，因为跨域导致报错。")]),t._v("\ndocument\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"myIFrame"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document\n"),a("span",{attrs:{class:"token comment"}},[t._v("// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 子窗口获取主窗口的 DOM 也会报错。")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 报错")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这种情况不仅适用于"),s("code",[this._v("iframe")]),this._v("窗口，还适用于"),s("code",[this._v("window.open")]),this._v("方法打开的窗口，只要跨域，父窗口与子窗口之间就无法通信。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"document-domain"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#document-domain","aria-hidden":"true"}},[this._v("#")]),this._v(" document.domain")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果两个窗口一级域名相同，只是二级域名不同，那么设置上一节介绍的"),s("code",[this._v("document.domain")]),this._v("属性，就可以规避同源政策，拿到 "),s("code",[this._v("DOM")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("片段识别符（"),s("code",[this._v("fragment identifier")]),this._v("）")]),s("li",[this._v("跨文档通信API（"),s("code",[this._v("Cross-document messaging")]),this._v("）")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-1-片段识别符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-片段识别符","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 片段识别符")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("片段标识符（"),a("code",[t._v("fragment identifier")]),t._v("）指的是，"),a("code",[t._v("URL")]),t._v(" 的"),a("code",[t._v("#")]),t._v("号后面的部分，比如"),a("code",[t._v("http://example.com/x.html#fragment")]),t._v("的"),a("code",[t._v("#fragment")]),t._v("。"),a("strong",[t._v("如果只是改变片段标识符，页面不会重新刷新。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"父窗口可以把信息，写入子窗口的片段标识符。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#父窗口可以把信息，写入子窗口的片段标识符。","aria-hidden":"true"}},[this._v("#")]),this._v(" 父窗口可以把信息，写入子窗口的片段标识符。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口把所要传递的信息，写入 iframe 窗口的片段标识符。")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" src "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" originURL "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'myIFrame'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" src"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 子窗口通过监听 hashchange 事件得到通知。")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onhashchange "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkMessage"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("checkMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" message "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"子窗口也可以改变父窗口的片段标识符。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#子窗口也可以改变父窗口的片段标识符。","aria-hidden":"true"}},[this._v("#")]),this._v(" 子窗口也可以改变父窗口的片段标识符。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" target "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" hash"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-2-window-postmessage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-window-postmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 window.postMessage()")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("上面的这种方法属于破解，"),a("code",[t._v("HTML5")]),t._v(" 为了解决这个问题，引入了一个全新的"),a("code",[t._v("API")]),t._v("：跨文档通信 "),a("code",[t._v("API")]),t._v("（"),a("code",[t._v("Cross-document messaging")]),t._v("）。这个 "),a("code",[t._v("API")]),t._v(" 为"),a("code",[t._v("window")]),t._v("对象新增了一个"),a("code",[t._v("window.postMessage")]),t._v("方法，允许跨窗口通信，不论这两个窗口是否同源。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"postmessage方法-发送消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postmessage方法-发送消息","aria-hidden":"true"}},[this._v("#")]),this._v(" postMessage方法 - 发送消息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第一个参数是具体的信息内容，")]),s("li",[this._v("第二个参数是接收消息的窗口的源（"),s("code",[this._v("origin")]),this._v("），即“协议 + 域名 + 端口”。也可以设为"),s("code",[this._v("*")]),this._v("，表示不限制域名，向所有窗口发送。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"父窗口向子窗口发消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#父窗口向子窗口发消息","aria-hidden":"true"}},[this._v("#")]),this._v(" 父窗口向子窗口发消息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("父窗口"),s("code",[this._v("aaa.com")]),this._v("向子窗口"),s("code",[this._v("bbb.com")]),this._v("发消息，调用"),s("code",[this._v("postMessage")]),this._v("方法实现。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口打开一个子窗口")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" popup "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("open")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'title'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口向子窗口发消息")]),t._v("\npopup"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Hello World!'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"子窗口向父窗口发送消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#子窗口向父窗口发送消息","aria-hidden":"true"}},[this._v("#")]),this._v(" 子窗口向父窗口发送消息")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 子窗口向父窗口发消息")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opener"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Nice to see you'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"message-事件-获取消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#message-事件-获取消息","aria-hidden":"true"}},[this._v("#")]),this._v(" message 事件 - 获取消息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("父窗口和子窗口都可以通过"),s("code",[this._v("message")]),this._v("事件，监听对方的消息。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口和子窗口都可以用下面的代码，")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 监听 message 消息")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'message'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("message")]),this._v("事件的参数是事件对象"),s("code",[this._v("event")]),this._v("，提供以下三个属性。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("event.source")]),this._v("：发送消息的窗口")]),s("li",[s("code",[this._v("event.origin")]),this._v(": 消息发向的网址")]),s("li",[s("code",[this._v("event.data")]),this._v(": 消息内容")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 子窗口通过`event.source`属性引用父窗口，然后发送消息")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'message'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiveMessage"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("receiveMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("source"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Nice to see you!'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'*'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("首先，"),s("code",[this._v("receiveMessage")]),this._v("函数里面没有过滤信息的来源，任意网址发来的信息都会被处理。")]),s("li",[this._v("其次，"),s("code",[this._v("postMessage")]),this._v("方法中指定的目标窗口的网址是一个星号，表示该信息可以向任意网址发送。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("event.origin")]),this._v("属性可以过滤不是发给本窗口的消息。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'message'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiveMessage"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("receiveMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),a("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("source"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-3-localstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-localstorage","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 LocalStorage")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过"),s("code",[this._v("window.postMessage")]),this._v("，读写其他窗口的 "),s("code",[this._v("LocalStorage")]),this._v(" 也成为了可能。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 父窗口发送消息")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" win "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'iframe'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Jack'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'storage'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" obj"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 子窗口将父窗口发来的消息，写入自己的 LocalStorage。")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),a("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" payload "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("parse")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  localStorage"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setItem")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"加强版父子窗口通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加强版父子窗口通信","aria-hidden":"true"}},[this._v("#")]),this._v(" 加强版父子窗口通信")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 加强版的父窗口发送消息代码如下。")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" win "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'iframe'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Jack'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 存入对象")]),t._v("\nwin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'storage'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'set'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" obj"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 读取对象")]),t._v("\nwin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'storage'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"get"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("parse")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 加强版的子窗口接收消息的代码如下。")]),t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),a("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" payload "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("parse")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'set'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      localStorage"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setItem")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("break")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'get'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" parent "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" localStorage"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getItem")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("break")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'remove'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      localStorage"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("removeItem")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("break")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_4、ajax"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、ajax","aria-hidden":"true"}},[this._v("#")]),this._v(" 4、AJAX")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_4-1-jsonp-json-parse"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-jsonp-json-parse","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.1 JSONP - JSON.parse")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[s("code",[this._v("JSONP")]),this._v(" 是服务器与客户端跨源通信的常用方法。最大特点就是简单易用，没有兼容性问题，老式浏览器全部支持，服务端改造非常小。"),s("code",[this._v("JSONP")]),this._v("只能发"),s("code",[this._v("get")]),this._v("请求，它的做法如下。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("strong",[this._v("第一步")]),this._v("，网页添加一个"),s("code",[this._v("<script>")]),this._v("元素，向服务器请求一个脚本，这不受同源政策限制，可以跨域请求。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://api.foo.com?callback=bar"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}}),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("strong",[t._v("注意")]),t._v("，请求的脚本网址有一个"),a("code",[t._v("callback")]),t._v("参数（"),a("code",[t._v("?callback=bar")]),t._v("），用来告诉服务器，客户端的回调函数名称（"),a("code",[t._v("bar")]),t._v("）。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("strong",[t._v("第二步")]),t._v("，服务器收到请求后，拼接一个字符串，将 "),a("code",[t._v("JSON")]),t._v(" 数据放在函数名里面，作为字符串返回（"),a("code",[t._v("bar({...})")]),t._v("）。")]),a("li",[a("strong",[t._v("第三步")]),t._v("，客户端会将服务器返回的字符串，作为代码解析，因为浏览器认为，这是"),a("code",[t._v("<script>")]),t._v("标签请求的脚本内容。这时，客户端只要定义了"),a("code",[t._v("bar()")]),t._v("函数，就能在该函数体内，拿到服务器返回的 "),a("code",[t._v("JSON")]),t._v(" 数据。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"首先，网页动态插入-script-元素，由它向跨域网址发出请求。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#首先，网页动态插入-script-元素，由它向跨域网址发出请求。","aria-hidden":"true"}},[this._v("#")]),this._v(" 首先，网页动态插入"),s("code",[this._v("<script>")]),this._v("元素，由它向跨域网址发出请求。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 动态添加`<script>`元素，向服务器`example.com`发出请求")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("addScriptTag")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("src"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("createElement")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'script'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setAttribute")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'type'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'text/javascript'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" src"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("addScriptTag")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'http://example.com/ip?callback=foo'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("foo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Your public IP address is: '")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ip"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("注意")]),this._v("，该请求的查询字符串有一个"),s("code",[this._v("callback")]),this._v("参数，用来指定回调函数的名字，这对于 "),s("code",[this._v("JSONP")]),this._v(" 是必需的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("foo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v("'ip'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'8.8.8.8'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("由于"),a("code",[t._v("<script>")]),t._v("元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了"),a("code",[t._v("foo")]),t._v("函数，该函数就会立即调用。作为参数的 "),a("code",[t._v("JSON")]),t._v(" 数据被视为 "),a("code",[t._v("JavaScript")]),t._v(" 对象，而不是字符串，因此避免了使用"),a("code",[t._v("JSON.parse")]),t._v("的步骤。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_4-2-websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-websocket","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2 WebSocket")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("WebSocket")]),this._v(" 是一种通信协议，使用"),s("code",[this._v("ws://")]),this._v("（非加密）和"),s("code",[this._v("wss://")]),this._v("（加密）作为协议前缀。该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下面是一个例子，浏览器发出的 "),s("code",[this._v("WebSocket")]),this._v(" 请求的头信息（摘自维基百科）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\nOrigin: http://example.com\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面代码中，有一个字段是"),s("code",[this._v("Origin")]),this._v("，表示该请求的请求源（"),s("code",[this._v("origin")]),this._v("），即发自哪个域名。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("正是因为有了"),s("code",[this._v("Origin")]),this._v("这个字段，所以 "),s("code",[this._v("WebSocket")]),this._v(" 才没有实行同源政策。因为服务器可以根据这个字段，判断是否许可本次通信。如果该域名在白名单内，服务器就会做出如下回应。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_4-3-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-cors","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.3 CORS")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("CORS")]),t._v(" 是跨源资源分享（"),a("code",[t._v("Cross-Origin Resource Sharing")]),t._v("）的缩写。它是 "),a("code",[t._v("W3C")]),t._v(" 标准，属于"),a("strong",[t._v("跨源 "),a("code",[t._v("AJAX")]),t._v(" 请求的根本解决方法")]),t._v("。相比 "),a("code",[t._v("JSONP")]),t._v(" 只能发"),a("code",[t._v("GET")]),t._v("请求，"),a("code",[t._v("CORS")]),t._v(" 允许任何类型的请求。")])}],!1,null,null,null);s.default=e.exports}}]);