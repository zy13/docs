(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{403:function(t,a,s){"use strict";s.r(a);var n=s(1),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h2",{attrs:{id:"_1、beforeunload-事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、beforeunload-事件","aria-hidden":"true"}},[t._v("#")]),t._v(" 1、beforeunload 事件")]),s("p",[s("code",[t._v("beforeunload")]),t._v("事件在窗口、文档、各种资源将要卸载前触发。它可以用来防止用户不小心卸载资源。")]),s("p",[t._v("如果该事件对象的"),s("code",[t._v("returnValue")]),t._v("属性是一个非空字符串，那么浏览器就会弹出一个对话框，询问用户是否要卸载该资源。但是，用户指定的字符串可能无法显示，浏览器会展示预定义的字符串。如果用户点击“取消”按钮，资源就不会卸载。")]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 用户如果关闭窗口，浏览器会弹出一个窗口，要求用户确认。")]),t._v("\nwindow"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'beforeunload'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("returnValue "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'你确定离开吗？'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("浏览器对这个事件的行为很不一致，有的浏览器调用"),s("code",[t._v("event.preventDefault()")]),t._v("，也会弹出对话框。"),s("code",[t._v("IE")]),t._v(" 浏览器需要显式返回一个非空的字符串，才会弹出对话框。而且，大多数浏览器在对话框中不显示指定文本，只显示默认文本。因此，可以采用下面的写法，取得最大的兼容性。")]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'beforeunload'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" confirmationMessage "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'确认关闭窗口？'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("returnValue "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" confirmationMessage"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" confirmationMessage"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注意，许多手机浏览器（比如 "),s("code",[t._v("Safari")]),t._v("）默认忽略这个事件，桌面浏览器也有办法忽略这个事件。所以，它可能根本不会生效，不能依赖它来阻止用户关闭浏览器窗口，最好不要使用这个事件。")])]),s("p",[t._v("另外，一旦使用了"),s("code",[t._v("beforeunload")]),t._v("事件，浏览器就不会缓存当前网页，使用“回退”按钮将重新向服务器请求网页。这是因为监听这个事件的目的，一般是为了网页状态，这时缓存页面的初始状态就没意义了。")]),s("h2",{attrs:{id:"_2、unload-事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、unload-事件","aria-hidden":"true"}},[t._v("#")]),t._v(" 2、unload 事件")]),s("p",[s("code",[t._v("unload")]),t._v("事件在窗口关闭或者"),s("code",[t._v("document")]),t._v("对象将要卸载时触发。它的触发顺序排在"),s("code",[t._v("beforeunload")]),t._v("、"),s("code",[t._v("pagehide")]),t._v("事件后面。")]),s("p",[s("code",[t._v("unload")]),t._v("事件发生时，文档处于一个特殊状态。所有资源依然存在，但是对用户来说都不可见，"),s("code",[t._v("UI")]),t._v(" 互动全部无效。这个事件是无法取消的，即使在监听函数里面抛出错误，也不能停止文档的卸载。")]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'unload'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'文档将要卸载'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("手机上，浏览器或系统可能会直接丢弃网页，这时该事件根本不会发生。而且跟"),s("code",[t._v("beforeunload")]),t._v("事件一样，一旦使用了"),s("code",[t._v("unload")]),t._v("事件，浏览器就不会缓存当前网页，理由同上。"),s("strong",[t._v("因此，任何情况下都不应该依赖这个事件，指定网页卸载时要执行的代码，可以考虑完全不使用这个事件。")])]),s("p",[s("strong",[t._v("该事件可以用"),s("code",[t._v("pagehide")]),t._v("代替。")])]),s("h2",{attrs:{id:"_3、load-事件，error-事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、load-事件，error-事件","aria-hidden":"true"}},[t._v("#")]),t._v(" 3、load 事件，error 事件")]),s("p",[s("code",[t._v("load")]),t._v("事件在页面或某个资源加载成功时触发。"),s("strong",[t._v("注意，页面或资源从浏览器缓存加载，并不会触发"),s("code",[t._v("load")]),t._v("事件")]),t._v("。")]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'load'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'所有资源都加载完成'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("code",[t._v("error")]),t._v("事件是在页面或资源加载失败时触发。"),s("code",[t._v("abort")]),t._v("事件在用户取消加载时触发。")]),s("p",[t._v("这三个事件实际上属于进度事件，不仅发生在"),s("code",[t._v("document")]),t._v("对象，还发生在各种外部资源上面。浏览网页就是一个加载各种资源的过程，图像（"),s("code",[t._v("image")]),t._v("）、样式表（"),s("code",[t._v("style sheet")]),t._v("）、脚本（"),s("code",[t._v("script")]),t._v("）、视频（"),s("code",[t._v("video")]),t._v("）、音频（"),s("code",[t._v("audio")]),t._v("）、"),s("code",[t._v("Ajax")]),t._v("请求（"),s("code",[t._v("XMLHttpRequest")]),t._v("）等等。这些资源和"),s("code",[t._v("document")]),t._v("对象、"),s("code",[t._v("window")]),t._v("对象、"),s("code",[t._v("XMLHttpRequestUpload")]),t._v(" 对象，都会触发"),s("code",[t._v("load")]),t._v("事件和"),s("code",[t._v("error")]),t._v("事件。")]),s("p",[s("strong",[t._v("最后，页面的"),s("code",[t._v("load")]),t._v("事件也可以用"),s("code",[t._v("pageshow")]),t._v("事件代替。")])])])}],!1,null,null,null);a.default=o.exports}}]);